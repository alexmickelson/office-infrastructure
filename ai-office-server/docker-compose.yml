services:
  openwebui:
    image: ghcr.io/open-webui/open-webui:latest
    container_name: openwebui
    ports:
      - "8080:8080"
    environment:
      - WEBUI_PORT=8080
      - OLLAMA_BASE_URL=http://localhost:11434
      - DATABASE_URL=postgresql://openwebui:9hb02121-9br@openwebui-db:5432/openwebui_db
      - ENABLE_OAUTH_SIGNUP=true
      - MCP_ENABLED=true
    volumes:
      - /data/openwebui:/app/backend/data
    restart: unless-stopped

  openwebui-db:
    image: postgres:17
    container_name: openwebui-db
    environment:
      POSTGRES_USER: openwebui
      POSTGRES_PASSWORD: 9hb02121-9br
      POSTGRES_DB: openwebui_db
    volumes:
      - /data/openwebui-pg:/var/lib/postgresql/data
    restart: always

  llama-swap:
    image: ghcr.io/mostlygeek/llama-swap:vulkan
    container_name: llama-swap
    restart: unless-stopped
    ports:
      - "9292:9292"
    volumes:
      - ./llamaswap/config.yml:/app/config.yaml
      - /data/llamaswap/models:/app/models
      - /home/alex/.lmstudio/models/lmstudio-community:/app/lmstudio-models:ro
    command: --listen :9292
    # privileged: true
    # cap_add:
    #   - SYS_ADMIN
    devices:
      - /dev/dri/renderD128:/dev/dri/renderD128
    group_add:
      - 303
